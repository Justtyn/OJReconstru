# Re Online Judge 前端开发日志

> 规则：每次完成一轮架构设计或编码后，必须新增一条记录；同一天多次提交可以多条。日志用于跟踪进度、风险与待办，结构固定如下。

---

## 2025-11-20 14:07 业务模块梳理

- **背景**：完成第 1 步「理解与抽象」，厘清后端接口覆盖范围并确认需要澄清的问题。
- **动作**：
  1. 阅读《Re Online Judge API》和《Re-OnlineJudge后端接口文档(25-11-20).md》。
  2. 通读《前端功能开发参考.md》了解目标页面结构。
  3. 梳理认证、题库、作业、讨论等模块及对应接口、主要字段。
  4. 输出客户端/管理端的模块职责矩阵并列出需确认问题。
- **产出/影响**：提交模块结构草图与接口列表，明确当前缺失的排行榜/统计/AI 接口及 Markdown 渲染需求。
- **问题&风险**：尚需在后续阶段关注 Markdown 渲染实现方式；扩展模块接口待后端补充。
- **待办 / 下一步**：
  - [ ] 根据确认结果输出整体前端架构设计（目录、路由、守卫、主题方案）。

## 2025-11-20 14:08 贡献指南编写

- **背景**：根据指示新增 AGENTS.md 作为仓库贡献指南，便于其他协作者遵循统一流程。
- **动作**：
  1. 调研 `package.json` 与目录结构，确定现有脚本、依赖与模块分布。
  2. 编写 200-400 字的《Repository Guidelines》，涵盖结构、命令、风格、测试、提交流程与安全提示。
  3. 将指南保存到根目录 `AGENTS.md` 并记录本次工作。
- **产出/影响**：新增标准化贡献文档，明确未来协作者的开发、提交和安全要求。
- **问题&风险**：暂无；未来根据测试栈或 lint 工具加入后需同步更新此文档。
- **待办 / 下一步**：
  - [ ] 继续进行第 2 步整体前端架构设计输出。

## 2025-11-20 14:08 前端架构方案设计

- **背景**：进入第 2 步要求，规划 client/admin 双端、路由、权限与主题切换方案，为后续初始化提供蓝图。
- **动作**：
  1. 明确单仓双入口（共享 Vite 工程 + 多 Layout）策略，列出目录划分示例。
  2. 设计客户端与后台路由草图，标注访问权限、角色要求与重定向策略。
  3. 描述 Pinia store 结构、axios 封装、router 守卫、主题切换（Ant Design ConfigProvider）方案。
  4. 输出计划供确认，暂不落地代码。
- **产出/影响**：形成正式前端架构方案，确定基础目录、守卫流程与主题实现路径。
- **问题&风险**：无；待确认后可进入项目初始化。
- **待办 / 下一步**：
  - [ ] 根据确认意见开展 Vite 项目初始化与基础设施搭建。

## 2025-11-20 16:28 架构方案确认

- **背景**：方案获批，进入第 3 步准备搭建 Vite+Vue3+TS 工程并实现基础设施。
- **动作**：
  1. 与用户确认目录、路由、守卫、主题、store 设计。
  2. 在日志中记录确认节点，为接下来的初始化与编码建立里程碑。
- **产出/影响**：正式进入项目初始化阶段，后续工作将按照既定方案推进。
- **问题&风险**：无。
- **待办 / 下一步**：
  - [ ] 初始化项目、安装依赖并搭建基础设施（第 3 步）。

## 2025-11-20 16:47 基础设施搭建

- **背景**：执行第 3 步，完成项目初始化、依赖声明、全局骨架、路由/状态/主题/请求封装及基础页面。
- **动作**：
  1. 补充 `axios`、`ant-design-vue`、`@ant-design/icons-vue` 依赖（npm 安装因受限网络多次超时，已在 `package.json` 声明，需本地重新执行 `npm install`）。
  2. 搭建目录结构（apps、layouts、router、stores、services、types、styles、utils），新增 Alias/tsconfig 配置。
  3. 实现 Pinia `auth`、`settings` store，配置 Router 守卫、白名单、client/admin 路由与布局。
  4. 编写 axios 拦截器、Auth Service、登录页、客户端首页、后台仪表盘、错误页与基础主题。
- **产出/影响**：形成可运行的前端基础框架，满足登录 -> 守卫 -> 客户端/后台跳转流程，为后续模块开发提供模板。
- **问题&风险**：依赖未能在当前环境安装，需在联网环境运行 `npm install`；尚未实现注册/忘记密码等页面。
- **待办 / 下一步**：
  - [ ] 按模块逐步实现客户端业务页面与服务调用（第 4 步）。

## 2025-11-20 16:58 客户端模块-公告

- **背景**：启动第 4 步客户端模块实现，优先落地“公告”以验证服务封装、Markdown 渲染与列表/详情交互。
- **动作**：
  1. 新增公告类型/服务（`src/types/dto/announcement.ts`、`src/services/modules/announcement.ts`），补充 `marked`、`dompurify`、`date-fns` 依赖与 `markdown` 工具。
  2. 在客户端路由与布局中加入 `/announcements` 入口。
  3. 开发 `AnnouncementList.vue`，提供搜索、置顶过滤、分页、详情抽屉及 Markdown 预览。
- **产出/影响**：客户端可浏览公告列表并查看详情，具备 Markdown 渲染与安全净化流程。
- **问题&风险**：受网络限制新增依赖仍需本地 `npm install`；后续需扩展更多筛选项及缓存策略。
- **待办 / 下一步**：
  - [ ] 实现下一个客户端业务模块（例如题库或班级/作业）。

## 2025-11-20 17:09 身份体系加强计划

- **背景**：根据新要求，需在开发业务模块前完善登录/注册/邮箱验证/找回密码及多角色跳转体验，确保 Token 与用户信息完整存储。
- **动作**：
  1. 评估 Auth 模块需覆盖的接口：`/api/auth/register`、`/verifyEmail`、`/login`、`/logout`、`/password/forgot/*`、`/password/change`。
  2. 规划 `AuthLayout`、验证码组件、注册/忘记密码页面及主题一致性方案。
  3. 明确学生进入客户端、教师/管理员进入管理端的守卫逻辑。
- **产出/影响**：确定“先强化身份模块再扩展业务”路线，为接下来的页面开发提供方向。
- **问题&风险**：无（需留意暗色/浅色主题在 Auth 页的适配）。
- **待办 / 下一步**：
  - [ ] 设计并实现 Auth 页面及相关 service/store 改造。

## 2025-11-20 17:15 身份模块实现

- **背景**：落地登录/注册/邮箱验证/找回密码流程，确保三角色分流与主题统一，满足“先完善身份模块再开发业务”的要求。
- **动作**：
  1. 新增 Auth 服务与类型（注册、验证、忘记密码、改密）以及 Pinia 扩展（session 恢复、pendingVerifyUser、验证码发送等）。
  2. 构建 `AuthLayout`、`ThemeSwitcher`、`Logo`，更新 Client/Admin Layout 主题切换；编写登录/注册/验证/找回密码页面，集成角色分流与现代 UI。
  3. 加强 Router 守卫（按角色区分 client/admin 入口），完善主题 Store（监听系统主题、设置 `data-theme`），补充 Markdown/DOMPurify 依赖提示。
- **产出/影响**：完整的身份体系已就绪：注册→发信→验证→登录→按角色跳转；忘记密码具备两步校验；界面支持深浅主题切换，整体设计统一。
- **问题&风险**：新增依赖（marked、dompurify、date-fns 等）仍需在有网络环境执行 `npm install`；`package-lock.json` 未更新，待安装后同步。
- **待办 / 下一步**：
  - [ ] 基于完善的身份体系继续推进客户端业务模块（题库/班级/作业等）。

## 2025-11-20 17:19 Bug 修复（主题图标）

- **背景**：本地运行时报 `MoonOutlined` 未导出导致路由初始化失败，登录页无法渲染，需要快速修复 ThemeSwitcher。
- **动作**：
  1. 将 ThemeSwitcher 中的深色模式图标改为 `BgColorsOutlined`，确保所用 icon 均存在于 `@ant-design/icons-vue`。
  2. 抽查登录页渲染确认不再抛出模块解析错误。
- **产出/影响**：修复后应用可正常加载登录页，黑屏问题消除。
- **问题&风险**：无。
- **待办 / 下一步**：
  - [ ] 继续推进客户端业务模块开发。

## 2025-11-20 18:21 Auth 体验优化

- **背景**：根据反馈调整登录/注册等页面的居中样式，并限制注册仅创建学生账号，同时确保表单操作直连真实 API。
- **动作**：
  1. 在全局样式增加 `.auth-form`，并为登录/注册/验证/找回密码表单应用该类，实现输入区域水平居中。
  2. 注册页移除角色选择，固定仅创建 `student`，并加入说明提示；其余流程继续复用 `authService`。
  3. 验证相关组件的 UI 小幅调整（Info Alert 等），确保体验一致。
- **产出/影响**：登录/注册页视觉居中；注册逻辑与后端约束一致，避免教师/管理员直接前台注册。
- **问题&风险**：无。
- **待办 / 下一步**：
  - [ ] 开始实现管理端（管理员/教师）模块。

## 2025-11-20 18:28 Auth 表单触发兼容

- **背景**：用户端反馈某些浏览器/插件拦截 form submit 导致登录/注册无响应，需要保证按钮点击即可触发请求。
- **动作**：
  1. 为登录/注册/验证/找回密码表单新增 `@keyup.enter` 监听，并让按钮改用 `@click="handleXXX"`（不再依赖原生 submit）。
  2. 保留 `@submit.prevent` 以拦截默认行为，确保即便插件影响原生 submit，点击按钮仍可发起 API 请求。
- **产出/影响**：Auth 表单在各种环境下都能触发校验与网络请求，解决“点击无效”的问题。
- **问题&风险**：暂无。
- **待办 / 下一步**：
  - [ ] 继续实现管理端模块。

## 2025-11-20 18:34 开发环境 API 配置

- **背景**：前端默认 baseURL 为空导致请求落在 Vite 本地地址，需要明确指向后端 `localhost:8080`。
- **动作**：
  1. 新增 `.env.development`，设置 `VITE_API_BASE_URL=http://localhost:8080`。
  2. 确认 axios 实例读取该变量，重启 dev server 后所有 API 将直连后端接口。
- **产出/影响**：开发环境下登录/注册等请求会发送到后端服务，无需手动修改代码。
- **问题&风险**：若后端端口或域名不同，需要对应调整 `.env.*`；请勿提交生产环境敏感地址。
- **待办 / 下一步**：
  - [ ] 实现管理端业务页面。

## 2025-11-20 18:43 管理端管理员/教师模块

- **背景**：根据步骤要求实现后台管理员与教师管理功能（列表、表单、启用/禁用、删除等），并补齐类型/服务/路由。
- **动作**：
  1. 新增用户相关类型、分页定义、服务封装（`adminUserService`、`teacherService`），并为 axios 引入 `dayjs` 依赖用于日期格式化。
  2. 扩展路由与 AdminLayout 菜单，新增 `/admin/users/*`、`/admin/teachers/*`，按角色控制可见范围。
  3. 实现 `AdminList/AdminEdit`、`TeacherList/TeacherEdit` 页面：包含筛选表单、表格分页、启禁与删除操作、表单验证（邮箱/手机号/密码），并与真实 API 对接。
- **产出/影响**：管理端已具备管理员与教师的增删改查 UI，角色访问及权限按钮控制齐备，可以在成功登录后直接操作后端数据。
- **问题&风险**：`dayjs` 等新依赖需 `npm install`；启禁操作基于 `isActive` 字段，若后端命名不同需同步调整。
- **待办 / 下一步**：
  - [ ] 按计划继续扩展其他管理模块（班级、公告等）。

## 2025-11-20 18:52 管理端表格编译错误修复

- **背景**：由于在 `<script setup>` 中使用 JSX 自定义列导致 Vite 动态导入失败（500 错误），需改用 AntD Table 的 slot 写法。
- **动作**：
  1. `AdminList.vue` 与 `TeacherList.vue` 改为定义 `columns` 并通过 `<template #bodyCell>` 渲染状态/操作列，不再依赖 JSX。
  2. 引入 `TableColumnType` 类型，确保 TS 推断正确；重新格式化操作区逻辑。
- **产出/影响**：路由懒加载可以正常解析，管理端列表页成功编译渲染。
- **问题&风险**：无。
- **待办 / 下一步**：
  - [ ] 继续扩展其他后台模块。

## 2025-11-20 18:59 Admin/Teacher 列表加载 & ID 精度修复

- **背景**：Vite 仍然因 `dayjs`（未安装）报 500，教师详情请求也因大整数 ID 被 `Number()` 截断导致 404。
- **动作**：
  1. 列表页改用 `date-fns`（已有依赖）格式化时间并移除 `dayjs` 引用；同步删除 `package.json` 中的 `dayjs` 依赖。
  2. 将 `AdminUser`、`Teacher` 的 `id` 类型改为 `string`，服务/页面调用不再做 `Number()` 转换，直接使用路由参数字符串请求后端。
- **产出/影响**：管理端列表组件可正常按需加载，教师编辑不再 404。
- **问题&风险**：如后端 ID 后续改为数字，请同步更新类型。
- **待办 / 下一步**：
  - [ ] 继续构建其他管理模块。

## YYYY-MM-DD HH:mm 模块/阶段标题

- **背景**：当前处理的任务或阶段目标说明。
- **动作**：
  1. ...
  2. ...
- **产出/影响**：本次产出的文件、模块、接口或其他显著结果。
- **问题&风险**：发现的阻碍、需确认事项（若无写“无”）。
- **待办 / 下一步**：
  - [ ] TODO 1
  - [ ] TODO 2

> 注：将 `YYYY-MM-DD HH:mm` 替换为实际时间，动作列表采用动词开头描述具体行为；待办勾选完成后改为 `[x]`。

## 2025-11-20 22:10 深色适配与公告筛选修复

- **背景**：深色模式下布局仍有白底，公告后台置顶筛选未生效，角色入口需区分客户端/管理端。
- **动作**：
  1. 全局和 `PageContainer` 使用主题变量控制背景/文字颜色，适配 Ant Layout/Card，解决深色模式白底。
  2. 客户端顶部菜单仅学生显示个人中心，管理员/教师看到管理系统入口；路由只阻止学生访问后台。
  3. 公告管理置顶筛选参数同时传 `pinnedOnly/isPinned` 并在切换时立即触发查询。
  4. 修复 Axios 包装和 TS 类型问题，确保构建通过。
- **产出/影响**：深色模式视觉一致；角色导航符合预期；公告置顶筛选可生效；`npm run build` 通过。
- **问题&风险**：公告筛选依赖后端对 `pinnedOnly/isPinned` 支持，如仍无效需确认后端实现。
- **待办 / 下一步**：
  - [ ] 若后端改动筛选参数，前端同步调整。

## 2025-11-21 08:02 学生管理 & 登录日志实现

- **背景**：按计划补齐后台学生管理与日志管理，需对齐接口字段、深浅色主题和分页体验。
- **动作**：
  1. 学生列表改用用户名/邮箱查询参数，保持分页、验证状态 Tag 展示，避免使用后端未支持的 keyword。
  2. 新增登录日志类型与服务（列表/详情/删除），路由与侧栏菜单加入“登录日志”入口（仅管理员可见）。
  3. 开发登录日志列表页：角色/UserID 过滤、成功/失败 Badge、登录/登出时间格式化、查看 Drawer 展示 IP/UA/设备/失败原因，支持删除记录。
- **产出/影响**：后台可直接检索并维护学生数据，管理员可查看/删除登录日志，界面延续卡片与深浅色主题。
- **问题&风险**：日志接口未提供时间范围过滤，后续可追加；删除日志可能需审批，请确认运营策略；UserID 当作字符串传递以避免大整数截断。
- **待办 / 下一步**：
  - [ ] 若需要时间范围/成功状态筛选，与后端确认参数后追加。
  - [ ] 补充日志导出或批量删除能力（如有需求）。

## 2025-11-21 08:12 题目管理与用例管理落地

- **背景**：按计划接入后台题目表与题目用例表，支持题目 CRUD、用例查看/编辑/删除，页面需沿用统一主题与分页交互。
- **动作**：
  1. 新增题目/用例类型、服务与管理员路由、侧栏菜单入口（题目管理），合并到 admin。
  2. 开发题目列表页：关键词/难度/标签/状态筛选，难度 Tag、状态 Badge、分页与删除确认。
  3. 开发题目编辑页：基础信息表单（标题/难度/限时/内存/标签/描述/输入/输出/提示/状态），并内嵌用例表格与用例抽屉表单，支持新增/编辑/删除用例、样例标记/启用开关、输入输出多行编辑。
- **产出/影响**：后台可新建/编辑题目并管理其测试用例；角色入口对齐教师/管理员；统一深浅色卡片、抽屉与分页。
- **问题&风险**：后端用例接口路径假设 `/api/problems/{id}/cases` 与 `/api/problem-cases/{caseId}`，若不一致需调整；缺少时间范围筛选/用例批量导入，如有需求再补。
- **待办 / 下一步**：
  - [ ] 确认后端用例接口与字段（score/isSample/isActive）是否一致，若不同调整服务层。
  - [ ] 补充题目内容的富文本/Markdown 编辑与预览（如有需求）。
  - [ ] 若用例详情路径/字段更新，需要同步服务层（已对齐 `/api/admin/problem-testcases/{id}`）。
  - [ ] 已将题目创建/更新/查询改为 `/api/admin/problems/*`，如再有权限或路径变更需同步。

## 2025-11-21 07:56 学生管理与登录日志计划

- **背景**：进入后台模块扩展阶段，下一轮需完成学生管理与登录日志管理，需先对齐接口字段与表单/筛选设计。
- **动作**：
  1. 阅读 `doc/API_DOC.md` 中 `student-controller`、`login-log-controller` 接口，确认列表分页参数（用户名/邮箱/角色/用户ID）及详情/增改字段（出生日期、学校、设备信息等）。
  2. 规划学生管理页面的表单与表格列：支持用户名/邮箱模糊搜索、性别/学校等基础字段编辑，保持启用/删除操作与管理员、教师模块一致。
  3. 设计登录日志列表：展示角色、用户、IP、UA、设备、登录/登出时间、成功状态；支持按角色、用户过滤并保留深浅色一致的表头卡片样式。
  4. 评估所需 UI 组件（RangePicker、Tag、Badge 等）与复用的主题 token，避免硬编码颜色，确保操作列与卡片阴影在暗色模式可读。
- **产出/影响**：明确学生与登录日志模块的字段、交互与主题要求，可直接进入编码实现。
- **问题&风险**：接口未提供时间范围过滤，日志分页可能较大需加加载状态与空/错误态；学生表单的日期格式需与后端 `yyyy-MM-dd` 保持一致。
- **待办 / 下一步**：
  - [ ] 开发学生管理列表/表单/启禁删除流程并接入服务层。
  - [ ] 开发登录日志列表与详情查看，补齐筛选与分页体验。
